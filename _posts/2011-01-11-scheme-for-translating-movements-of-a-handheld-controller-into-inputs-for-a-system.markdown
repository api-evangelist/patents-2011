---

title: Scheme for translating movements of a hand-held controller into inputs for a system
abstract: One embodiment provides a method for use in providing input to a system that includes the steps of determining position information for a controller for the system, comparing the determined position information for the controller with predetermined position information associated with commands, and providing a command to the system if the determined position information matches predetermined position information for the command.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09381424&OS=09381424&RS=09381424
owner: Sony Interactive Entertainment America LLC
number: 09381424
owner_city: San Mateo
owner_country: US
publication_date: 20110111
---
This application is a continuation application of U.S. patent application Ser. No. 11 382 037 entitled SCHEME FOR TRANSLATING MOVEMENTS OF A HAND HELD CONTROLLER INTO INPUTS FOR A SYSTEM filed on May 6 2006 which is a continuation in part CIP of U.S. patent application Ser. No. 10 207 677 entitled MAN MACHINE INTERFACE USING A DEFORMABLE DEVICE filed on Jul. 27 2002 U.S. patent application Ser. No. 10 650 409 entitled AUDIO INPUT SYSTEM filed on Aug. 27 2003 U.S. patent application Ser. No. 10 663 236 entitled METHOD AND APPARATUS FOR ADJUSTING A VIEW OF A SCENE BEING DISPLAYED ACCORDING TO TRACKED HEAD MOTION filed on Sep. 15 2003 U.S. patent application Ser. No. 10 759 782 entitled METHOD AND APPARATUS FOR LIGHT INPUT DEVICE filed on Jan. 16 2004 U.S. patent application Ser. No. 10 820 469 entitled METHOD AND APPARATUS TO DETECT AND REMOVE AUDIO DISTURBANCES filed on Apr. 7 2004 U.S. Patent application Ser. No. 11 301 673 entitled METHOD FOR USING RELATIVE HEAD AND HAND POSITIONS TO ENABLE A POINTING INTERFACE VIA CAMERA TRACKING filed on Dec. 12 2005 U.S. patent application Ser. No. 11 381 729 to Xiao Dong Mao entitled ULTRA SMALL MICROPHONE ARRAY filed on May 4 2006 U.S. patent application Ser. No. 11 381 728 to Xiao Dong Mao entitled ECHO AND NOISE CANCELLATION filed on May 4 2006 U.S. patent application Ser. No. 11 381 725 to Xiao Dong Mao entitled METHODS AND APPARATUS FOR TARGETED SOUND DETECTION filed on May 4 2006 U.S. patent application Ser. No. 11 381 727 to Xiao Dong Mao entitled NOISE REMOVAL FOR ELECTRONIC DEVICE WITH FAR FIELD MICROPHONE ON CONSOLE filed on May 4 2006 U.S. patent application Ser. No. 11 381 724 to Xiao Dong Mao entitled METHODS AND APPARATUS FOR TARGETED SOUND DETECTION AND CHARACTERIZATION filed on May 4 2006 U.S. patent application Ser. No. 11 381 721 to Xiao Dong Mao entitled SELECTIVE SOUND SOURCE LISTENING IN CONJUNCTION WITH COMPUTER INTERACTIVE PROCESSING filed on May 4 2006 all of which are hereby incorporated by reference and U.S. patent application Ser. No. 11 382 037 entitled SCHEME FOR TRANSLATING MOVEMENTS OF A HAND HELD CONTROLLER INTO INPUTS FOR A SYSTEM claims benefit of U.S. Provisional Patent Application No. 60 718 145 entitled AUDIO VIDEO SIMULATION AND USER INTERFACE PARADIGMS filed Sep. 15 2005 which is hereby incorporated by reference.

This application is also related to co pending application Ser. No. 11 418 988 to Xiao Dong Mao entitled METHODS AND APPARATUSES FOR ADJUSTING A LISTENING AREA FOR CAPTURING SOUNDS filed on May 4 2006 the entire disclosures of which are incorporated herein by reference. This application is also related to co pending application Ser. No. 11 418 989 to Xiao Dong Mao entitled METHODS AND APPARATUSES FOR CAPTURING AN AUDIO SIGNAL BASED ON VISUAL IMAGE filed on May 4 2006 the entire disclosures of which are incorporated herein by reference. This application is also related to co pending application Ser. No. 11 429 047 to Xiao Dong Mao entitled METHODS AND APPARATUSES FOR CAPTURING AN AUDIO SIGNAL BASED ON A LOCATION OF THE SIGNAL filed on May 4 2006 the entire disclosures of which are incorporated herein by reference. This application is also related to co pending application Ser. No. 11 429 133 to Richard Marks et al. entitled SELECTIVE SOUND SOURCE LISTENING IN CONJUNCTION WITH COMPUTER INTERACTIVE PROCESSING filed on May 4 2006 the entire disclosures of which are incorporated herein by reference. This application is also related to co pending application Ser. No. 11 429 414 to Richard Marks et al. entitled COMPUTER IMAGE AND AUDIO PROCESSING OF INTENSITY AND INPUT DEVICES FOR INTERFACING WITH A COMPUTER PROGRAM filed on May 4 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 031 entitled MULTI INPUT GAME CONTROL MIXER filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 032 entitled SYSTEM FOR TRACKING USER MANIPULATIONS WITHIN AN ENVIRONMENT filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 033 entitled SYSTEM METHOD AND APPARATUS FOR THREE DIMENSIONAL INPUT CONTROL filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 035 entitled INERTIALLY TRACKABLE HAND HELD CONTROLLER filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 036 entitled METHOD AND SYSTEM FOR APPLYING GEARING EFFECTS TO VISUAL TRACKING filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 041 entitled METHOD AND SYSTEM FOR APPLYING GEARING EFFECTS TO INERTIAL TRACKING filed on May 7 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 038 entitled METHOD AND SYSTEM FOR APPLYING GEARING EFFECTS TO ACOUSTICAL TRACKING filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 040 entitled METHOD AND SYSTEM FOR APPLYING GEARING EFFECTS TO MULTI CHANNEL MIXED INPUT filed on May 7 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 034 entitled SCHEME FOR DETECTING AND TRACKING USER MANIPULATION OF A GAME CONTROLLER BODY filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 043 entitled DETECTABLE AND TRACKABLE HAND HELD CONTROLLER filed on May 7 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 11 382 039 entitled METHOD FOR MAPPING MOVEMENTS OF A HAND HELD CONTROLLER TO GAME COMMANDS filed on May 7 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 29 259 349 entitled CONTROLLER WITH INFRARED PORT filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 29 259 350 entitled CONTROLLER WITH TRACKING SENSORS filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application number 60 798 031 entitled DYNAMIC TARGET INTERFACE filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

This application is also related to co pending application Ser. No. 29 259 348 entitled TRACKED CONTROLLER DEVICE filed on May 6 2006 the entire disclosures of which are incorporated herein by reference.

The present invention relates generally to computer entertainment systems and more specifically to a user s manipulation of a controller for such computer entertainment systems.

Computer entertainment systems typically include a hand held controller game controller or other controller. A user or player uses the controller to send commands or other instructions to the entertainment system to control a video game or other simulation being played. For example the controller may be provided with a manipulator which is operated by the user such as a joy stick. The manipulated variable of the joy stick is converted from an analog value into a digital value which is sent to the game machine main frame. The controller may also be provided with buttons that can be operated by the user.

It is with respect to these and other background information factors that the present invention has evolved.

determining position information for a controller for the system comparing the determined position information for the controller with predetermined position information associated with commands and providing a command to the system if the determined position information matches predetermined position information for the command.

Another embodiment provides a system for use in providing input to a system comprising means for determining position information for a controller for the system means for comparing the determined position information for the controller with predetermined position information associated with commands and means for providing a command to the system if the determined position information matches predetermined position information for the command.

Another embodiment provides a computer program product comprising a medium for embodying a computer program for input to a computer and a computer program embodied in the medium for causing the computer to perform steps of determining position information for a controller for a system comparing the determined position information for the controller with predetermined position information associated with commands and providing a command to the system if the determined position information matches predetermined position information for the command.

A better understanding of the features and advantages of various embodiments of the present invention will be obtained by reference to the following detailed description and accompanying drawings which set forth an illustrative embodiment in which principles of embodiments of the invention are utilized.

The user or player of a video game typically holds the game controller with one or both hands in order to operate the buttons joy stick etc. located on the controller. Often times while playing the game the user will also move the entire controller itself around in the air as he or she simultaneously operates the buttons joy stick etc. Some users tend to get excited while playing the game and attempt to control actions or aspects of the game by moving the entire controller itself around in the air.

Various embodiments of the methods apparatus schemes and systems described herein provide for the detection capture and tracking of the movements motions and or manipulations of the entire controller body itself by the user. The detected movements motions and or manipulations of the entire controller body by the user may be used as additional commands to control various aspects of the game or other simulation being played.

Detecting and tracking a user s manipulations of a game controller body may be implemented in different ways. For example in some embodiments a camera peripheral can be used with the computer entertainment system to detect motions of the hand held controller body and transfer them into actions in a game. The camera can be used to detect many different types of motions of the controller such as for example up and down movements twisting movements side to side movements jerking movements wand like motions plunging motions etc. Such motions may correspond to various commands such that the motions are transferred into actions in a game.

Detecting and tracking the user s manipulations of a game controller body can be used to implement many different types of games simulations etc. that allow the user to for example engage in a sword or lightsaber fight use a wand to trace the shape of items engage in many different types of sporting events engage in on screen fights or other encounters etc.

Referring to there is illustrated a system that operates in accordance with an embodiment of the present invention. As illustrated a computer entertainment system or console uses a television or other video display to display the images of the video game or other simulation thereon. The game or other simulation may be stored on a DVD CD flash memory USB memory or other memory media that is inserted into the console . A user or player manipulates a game controller to control the video game or other simulation.

A camera or other video image capturing device is positioned so that the controller is within the camera s field of view . As illustrated the camera may be placed on the video display but it should be well understood that the camera may be located elsewhere. By way of example the camera may comprise a camera peripheral device such as the commercially available EyeToy product. But it should be well understood that any type or brand of camera may be used such as for example a web cam camera add on USB camera infrared IR capability camera fast frame capture rate camera etc.

During operation the user physically moves the controller itself. That is the user physically moves the entire controller around in the air. For example the controller may be moved in any direction by the user such as up down to one side to the other side twisted rolled shaken jerked plunged etc. These movements of the controller itself may be detected and captured by the camera by way of tracking through image analysis in a manner described below.

In general the detected and captured movements of the controller are used to generate position and orientation data for the controller . Because this data is gathered on an image frame by frame basis the data can be used to calculate many physical aspects of the movement of the controller such as for example its acceleration and velocity along any axis its tilt pitch yaw roll as well as any telemetry points of the controller .

The ability to detect and track the movements of the controller makes it possible to determine whether any predefined movements of the controller are performed. That is certain movement patterns or gestures of the controller may be predefined and used as input commands for the game or other simulation. For example a plunging downward gesture of the controller may be defined as one command a twisting gesture of the controller may be defined as another command a shaking gesture of the controller may be defined as another command and so on. In this way the manner in which the user physically moves the controller itself is used as another input for controlling the game which provides a more stimulating and entertaining experience for the user. Examples of how movements of the controller can be mapped to input commands for the game will be discussed below.

Referring to there is illustrated a more detailed view of the controller that is made in accordance with an embodiment of the present invention. The controller includes a body . The body is the part of the game controller that one would hold by hand or wear if it were a wearable game controller . An input device manipulable by a user is something such as for example a button or multi axis control stick on the controller. One or more buttons may be disposed on the body . The body may include a housing holdable by hand. The housing may include a handgrip graspable by hand. Thus during operation when the user physically moves the controller itself the user physically moves the body of the controller . The user moves the body around in the air or in free space.

The body may have a forward section to be oriented towards a screen when a progress of a game controlled in accordance with the game controller is displayed upon the screen. At least one input device may be assembled with the body with the input device manipulable by a user to register an input from the user.

One or more light emitting diodes LEDs may be disposed on the body that are arranged in a geometric shape. Or another type of photonically detectable PD element may be assembled with the body . A position of the photonically detectable element may be within an image being recorded by an image capture device when the forward section is oriented at least generally towards the screen. The positions of the PD element at different points in time may be quantifiable at quantify movement of the body in space.

In this embodiment the controller includes four light emitting diodes LEDs . As illustrated the four LEDs may be arranged in a substantially square or rectangular pattern and located on the bridge of the controller between the R and L buttons. Thus in this embodiment the geometric shape comprises a substantially square or rectangular pattern. The square or rectangular pattern formed by the four LEDs will be referred to herein as the bounding box formed by the LEDs.

It should be well understood that the geometric shape may comprise many different shapes. For example the geometric shape may comprise any linear or two dimensional pattern. Although a linear array of LEDs is preferred the LEDs may alternatively be arranged in a rectangular pattern or an arcuate pattern to facilitate determination of an image plane of the LED array when analyzing an image of the LED pattern obtained by an image capture camera.

While the illustrated embodiment of the controller utilizes four LEDs it should be well understood that other embodiments may utilize more than four LEDs or less than four LEDs. For example three LEDs will work and two LEDs will also work to provide tracking information. Even one LED can provide position information. Furthermore the LEDs may be located on a different part of the controller .

The four LEDs produce four points or dots that are perceived by camera . Because the camera is looking at the player with the controller in his hands the camera is able to track the movement of the controller by tracking the movement of the dots produced by the four LEDs and the bounding box that they form.

Namely as the user twists and rotates the controller body the projection of the four dots are cast on the image plane of the camera s outputs. Image analysis is used to track the user s manipulations of the controller and to determine controller position and orientation. Thus the four LEDs produce information regarding the body s movement. The positions of one or two controllers can be determined or the relative movements of two controllers can be tracked.

The bounding boxes and formed by the four LEDs are captured in the image plane of the camera . illustrates an example of the image plane of the camera showing the bounding boxes and . A physics analysis is performed to derive and determine the movements of the bounding box and how the rectangle of the bounding box deforms into different shapes based on the tilt yaw etc. of the controller. By projecting the bounding boxes on the image plane the position orientation acceleration velocity etc. of the controller can be determined which can in turn be used to track the user s manipulations of the game controller.

Referring to there is illustrated a method for use in obtaining information from a controller in accordance with an embodiment of the present invention. The method may be executed and performed by many different types of systems and devices such as for example entertainment systems and consoles computers consumer electronics device etc. An example of a system that may be used to perform the method will be described below.

The method begins in step in which a projection of a geometric shape established on the controller is received on an image plane of a camera. This step may be performed as has already been described above.

In step the movements and deformities in the projection of the geometric shape are analyzed. Namely the four dots of the bounding box are tracked and analyzed. Field and frame analysis is performed on the image plane of the camera output to analyze the manipulation of the four reference points to determine position orientation tilt yaw roll etc. of the controller. In addition acceleration of the controller can be tracked in any direction. Analysis of the frames of the image can give the acceleration along any axis. Telemetry points of the controller can also be computed. It can also be determined whether or not the controller is in a resting position or resting state such as for example when the controller is in a neutral or steady state near the user s waist.

As the controller rolls the image translates in the plane. Changes in the width of the rectangle of the bounding box indicate the controller is rolling. As the yaw of the controller is adjusted the width of the rectangle changes. Yaw maps to the width of the rectangle. Tilt of the controller influences the height of the rectangle.

For example the bounding box indicates that the controller was initially positioned looking fairly straight ahead at the camera. The bounding box indicates that the controller was then moved downward rolled and turned to the user s left.

It is difficult to know which side of the ground plane the controller is positioned on because the image plane only sees a deformed rectangle. For example this issue can occur if someone walks in front of and occludes the camera during a time when the user manipulates the controller and moves the controller to an equal distance on the other side of an axis horizon line. This may cause the bounding box to look the same in the image plane. This can also happen if the controller travels outside of the viewing region of the image capture device.

As such a determination may need to be made as to whether the deformation is caused by positive or negative tilt or roll positive and negative being related to up down and left right movements away from the steady state origin position . This can be solved by reading other telemetry from the controller or by strobing or modulating the LEDs to enable the video analyzer system to discriminate individual corners of the bounding box rectangle for tracking purposes. The LEDs may be strobed or modulated as an aid for discerning the different corners of the bounding box. Or each LED may have its own frequency as an aid for discerning the different corners of the bounding box. By identifing each specific corner of a bounding region i.e. each LED it can be determined which side of a horizontal line the controller is on at any point in time. In this way problems associated with the controller passing through the camera plane can be handled.

Tracking the movements and rotations of the bounding box on the screen is based on a frame by frame analysis. The camera s output creates the frames of image data. The projection of the bounding box is captured in software. The movements of the controller across the frames is based on the translation of the box.

The use of a high frame rate provides the ability to accurately track acceleration and changes in acceleration of the movement of the controller. That is by projecting the image on the plane at high rates the delta movements of the controller can be tracked. This provides the ability to plot the acceleration the points where the acceleration peaks out the points where gravity zeros out and the points of inflection. The points of inflection are the transition points where the controller stops and changes direction. All of this analysis is performed by analyzing the frames of the image and determining the position and deformation of the bounding box. By way of example frame rates of frames per second or higher may be used but it should well understood that any frame rate may be used.

As will be discussed below the history of previous frames may be mapped. This allows the previous telemetry of the controller to be looked at for determining certain parameters such as for example in tracking acceleration velocity and stopping points.

In step position information for the controller is determined based on the analysis of the movements and deformities in the projection of the geometric shape. By way of example an image analyzer may be used to perform one or both of steps and . Namely an image analyzer may be used to perform the analysis of the movements and deformations of the bounding boxes in the image plane of the camera. The output of the video camera may be coupled to the input of an image analyzer. An example of a system which may incorporate an image analyzer for implementing one or more of the methods schemes and functions described herein will be discussed below.

The image analyzer monitors the bounding box formed by the reference LEDs as captured in the image plane of the camera. The image analyzer analyzes the position rotation horizontal and vertical deformation of the bounding box to determine the physical user manipulation of the controller its position roll tilt and yaw coordinates. At the end of the image analysis the data may be output in the form of an output ID or the like. Such output IDs from the image analysis may include data such as the x y z coordinates acceleration and velocity along any axis that the controller is in a resting position or state etc. Thus at the end of image analysis the image analyzer can indicate where the controller is and whether a command is issued. And the image analyzer may be pinged at any instant of time and it may provide position orientation last command etc.

By way of example the image analyzer may provide but shall not be limited to providing the following outputs 

Each of these outputs may be generated by analyzing the movements and deformations of the bounding box as described above. These outputs may be further processed in order to track the movement of the controller. Such tracking will allow certain movements of the controller to be recognized which can then be used to trigger certain commands as described below. It should be well understood that many other outputs may be used in addition to or in replacement of the above listed outputs.

Additional inputs to the image analyzer may optionally be provided. Such optional inputs may include but shall not be limited the following 

SET NOISE LEVEL X Y or Z AXIS this is a reference tolerance when analyzing jitter of hands in the game 

As mentioned above the ability to detect and track the movements of the controller makes it possible to determine whether any predefined movements of the controller are performed. That is certain movement patterns or gestures of the controller may be mapped to input commands for the game or other simulation.

Referring to there is illustrated a method for use in providing input to a system in accordance with an embodiment of the present invention. The method begins in step in which position information for a controller for the system is determined. This step may be performed using the methods and techniques described above.

In step the determined position information for the controller is compared with predetermined position information associated with commands. That is any number of different movements gestures or manipulations of the controller may be mapped to various commands. This allows different movements gestures or manipulations of the controller to be mapped into game models. For example moving the controller up may be mapped to one command moving the controller down may be mapped to another command and moving the controller in any other direction may be mapped to other commands.

Similarly shaking the controller once may be mapped to one command shaking the controller twice may be mapped to another command and similarly shaking the controller three four five etc. times may be mapped to other commands. That is various gestures may be established based on shaking the controller a certain number of times. Still other gestures may be established based on shaking the controller up and down vigorously a certain number of times. Other movements of the controller such as twisting rolling etc. may be mapped to still other commands.

Thus various different trajectories of the game controller may be mapped onto gestures which trigger commands in the game. Each command is mapped to a predetermined movement of the controller. Such predetermined movements of the controller will have associated predetermined position information. In this embodiment the determined position information for the controller is compared with the predetermined position information to see if a command should be triggered.

By way of example such mapping of gestures to game commands may be implemented as follows. The outputs of the image analyzer may be used to determine position and orientation information for the controller. The image analyzer may output various different IDs that are indicative of position and orientation of the controller. For example one ID may be output for a steady state determination another ID may be output to indicate shaking of the controller and various other IDs may be output to indicate other orientations. Thus the use of such IDs may be used to output whether the controller is in steady state or is moving. If the controller is in steady state an ID may indicate how long the controller has been in steady state.

The determined position and orientation information for the controller may then be compared with predetermined position information associated with input commands for the game. If the determined position information matches the predetermined position information for a command then the command is provided to the entertainment system. Again various gestures such as pushing the controller up or down twisting in a circle right or left twisting while pulling it up or down rolling right or left etc. may all be mapped to various commands.

When a new command or gesture is recognized the image analyzer may trigger an interrupt. The triggering of such an interrupt may be used as part of the process of providing the command to the entertainment system. The system may optionally be configured so that zero acceleration points in the axes stop points and or other events also trigger interrupts.

In comparing the determined position and orientation information with the predetermined position information associated with input commands to see if there is a match it may often be the case that there is not an exact match. This is because with movement of the controller in free space it may be difficult to precisely recreate a predefined movement. Therefore the predetermined position information associated with input commands may be defined in terms of ranges tolerances and or thresholds that are considered to be close enough to the predetermined position information such as to activate the command. That is commands may be defined in terms of the thresholds or ranges. Thus in determining whether or not any commands or gestures have been identified the system may check to see if the determined position and orientation information falls within a range of a gesture. Thus the defined commands may have thresholds that can be looked at in determining whether or not to invoke the command.

Furthermore in comparing the determined position and orientation information with the predetermined position information associated with input commands to see if there is a match histories of previous frames may be saved or mapped. For example the frame buffer may be monitored or the system may otherwise keep running records of the history of the previous frames. The previous frames may be looked at to determine if any commands are met. The mapping of frame histories may allow the telemetry of the controller at a specific time to be determined to provide the position orientation in determining if a command is met.

Finally in step if the determined position information for the controller matches predetermined position information for a command the command is provided to the system. Such command may be used to cause an event to occur or not occur in a video game or other simulation.

In other embodiments the movements of a game controller may mapped to game commands such as for example in video game. With such a method which may be used in video games or other simulations position information for a controller that is being manipulated by a user is received. The position information is analyzed to determine whether a predetermined movement of the controller associated with a command has been performed. This analysis may be performed as described above. If the predetermined movement of the controller associated with a command has been performed then the command is executed by the game. The execution of the command may cause a visual effect or the like to occur on the video display that the game is being displayed on.

While the discussion herein is directed to the use of LEDs on the controller for a game or other entertainment system it should be well understood that the teachings provided herein may be applied to detect and track the movements of controllers for other types of systems devices consumer electronics etc. That is the LEDs of the game controller described above can be used to perform remote control functions for consumer electronics devises or any device. LEDs may be used on the controllers for many other types of systems and devices in order to detect and track the controllers so that such movements may be mapped to commands for those systems and device. Examples of such other types of systems and devices may include but are not limited to televisions stereos telephones computers home or office networks hand held computing or communication device etc.

Furthermore the teachings described herein may be applied to universal remote controls that have the ability to control several or many different devices. That is such universal remote controls may include LEDs as described herein such that movements of the universal remote control body may be used as input commands for several or many different devices or systems.

Moreover a game controller may have a universal remote function. For example such may comprise a body having a forward section to be oriented towards a screen when a progress of a game controlled in accordance with the game controller is displayed upon the screen. At least one input device may be assembled with the body with the input device manipulable by a user to register an input from the user. A signal encoder may be included. An infrared signal transmitter operable to transmit an infrared signal over the air using a signal generated by the signal encoder may be included. The signal encoder may be programmable to encode the signal with a selected one of a plurality of signaling codes for reception by an electronic device having an infrared receiver and a signal decoder operable with the selected one signaling code.

Moreover battery operated toys including toys molded into a form and style of a branded game can be formed having LEDs and form a tracked user manipulated body in the sensed environment.

In some embodiments the image analyzer can recognize a user or process audio authenticated gestures etc. A user may be identified by an analyzer in the system through a gesture and a gesture may be specific to a user. Gestures may be recorded by users and stored in models. The recordation process may optionally store audio generated during recordation of a gesture. The sensed environment may be sampled into a multi channel analyzer and processed. The processor may reference gesture models to determine and authenticate user identity or objects based on voice or acoustic patterns and to a high degree of accuracy and performance.

According to embodiments of the present invention the methods and techniques described herein may be implemented as part of a signal processing apparatus as depicted in . The apparatus may include a processor and a memory e.g. RAM DRAM ROM and the like . In addition the signal processing apparatus may have multiple processors if parallel processing is to be implemented. The memory may include data and code configured as described above.

Specifically the memory may include signal data . The memory may also contain calibration data e.g. data representing one or more inverse eigenmatrices Cfor one or more corresponding pre calibrated listening zones obtained from calibration of a microphone array . By way of example the memory may contain eignematrices for eighteen 20 degree sectors that encompass a microphone array .

The apparatus may also include well known support functions such as input output I O elements power supplies P S a clock CLK and cache . The apparatus may optionally include a mass storage device such as a disk drive CD ROM drive tape drive or the like to store programs and or data. The controller may also optionally include a display unit and user interface unit to facilitate interaction between the controller and a user. The display unit may be in the form of a cathode ray tube CRT or flat panel screen that displays text numerals graphical symbols or images. The user interface may include a keyboard mouse joystick light pen or other device. In addition the user interface may include a microphone video camera or other signal transducing device to provide for direct capture of a signal to be analyzed. The processor memory and other components of the system may exchange signals e.g. code instructions and data with each other via a system bus as shown in .

The microphone array may be coupled to the apparatus through the I O functions . The microphone array may include between about 2 and about 8 microphones preferably about 4 microphones with neighboring microphones separated by a distance of less than about 4 centimeters preferably between about 1 centimeter and about 2 centimeters. Preferably the microphones in the array are omni directional microphones. An optional image capture unit e.g. a digital camera may be coupled to the apparatus through the I O functions . One or more pointing actuators that are mechanically coupled to the camera may exchange signals with the processor via the I O functions .

As used herein the term I O generally refers to any program operation or device that transfers data to or from the system and to or from a peripheral device. Every data transfer may be regarded as an output from one device and an input into another. Peripheral devices include input only devices such as keyboards and mouses output only devices such as printers as well as devices such as a writable CD ROM that can act as both an input and an output device. The term peripheral device includes external devices such as a mouse keyboard printer monitor microphone game controller camera external Zip drive or scanner as well as internal devices such as a CD ROM drive CD R drive or internal modem or other peripheral such as a flash memory reader writer hard drive.

In certain embodiments of the invention the apparatus may be a video game unit which may include a joystick controller coupled to the processor via the I O functions either through wires e.g. a USB cable or wirelessly. The joystick controller may have analog joystick controls and conventional buttons that provide control signals commonly used during playing of video games. Such video games may be implemented as processor readable data and or instructions which may be stored in the memory or other processor readable medium such as one associated with the mass storage device .

The joystick controls may generally be configured so that moving a control stick left or right signals movement along the X axis and moving it forward up or back down signals movement along the Y axis. In joysticks that are configured for three dimensional movement twisting the stick left counter clockwise or right clockwise may signal movement along the Z axis. These three axis X Y and Z are often referred to as roll pitch and yaw respectively particularly in relation to an aircraft.

In addition to conventional features the joystick controller may include one or more inertial sensors which may provide position and or orientation information to the processor via an inertial signal. Orientation information may include angular information such as a tilt roll or yaw of the joystick controller . By way of example the inertial sensors may include any number and or combination of accelerometers gyroscopes or tilt sensors. In a preferred embodiment the inertial sensors include tilt sensors adapted to sense orientation of the joystick controller with respect to tilt and roll axes a first accelerometer adapted to sense acceleration along a yaw axis and a second accelerometer adapted to sense angular acceleration with respect to the yaw axis. An accelerometer may be implemented e.g. as a MEMS device including a mass mounted by one or more springs with sensors for sensing displacement of the mass relative to one or more directions. Signals from the sensors that are dependent on the displacement of the mass may be used to determine an acceleration of the joystick controller . Such techniques may be implemented by program code instructions which may be stored in the memory and executed by the processor .

By way of example an accelerometer suitable as the inertial sensor may be a simple mass elastically coupled at three or four points to a frame e.g. by springs. Pitch and roll axes lie in a plane that intersects the frame which is mounted to the joystick controller . As the frame and the joystick controller rotates about pitch and roll axes the mass will displace under the influence of gravity and the springs will elongate or compress in a way that depends on the angle of pitch and or roll. The displacement and of the mass can be sensed and converted to a signal that is dependent on the amount of pitch and or roll. Angular acceleration about the yaw axis or linear acceleration along the yaw axis may also produce characteristic patterns of compression and or elongation of the springs or motion of the mass that can be sensed and converted to signals that are dependent on the amount of angular or linear acceleration. Such an accelerometer device can measure tilt roll angular acceleration about the yaw axis and linear acceleration along the yaw axis by tracking movement of the mass or compression and expansion forces of the springs. There are a number of different ways to track the position of the mass and or or the forces exerted on it including resistive strain gauge material photonic sensors magnetic sensors hall effect devices piezoelectric devices capacitive sensors and the like.

In addition the joystick controller may include one or more light sources such as light emitting diodes LEDs . The light sources may be used to distinguish one controller from the other. For example one or more LEDs can accomplish this by flashing or holding an LED pattern code. By way of example LEDs can be provided on the joystick controller in a linear or two dimensional pattern. Although a linear array of LEDs is preferred the LEDs may alternatively be arranged in a rectangular pattern or an arcuate pattern to facilitate determination of an image plane of the LED array when analyzing an image of the LED pattern obtained by the image capture unit . Furthermore the LED pattern codes may also be used to determine the positioning of the joystick controller during game play. For instance the LEDs can assist in identifying tilt yaw and roll of the controllers. This detection pattern can assist in providing a better user feel in games such as aircraft flying games etc. The image capture unit may capture images containing the joystick controller and light sources . Analysis of such images can determine the location and or orientation of the joystick controller. Such analysis may be implemented by program code instructions stored in the memory and executed by the processor . To facilitate capture of images of the light sources by the image capture unit the light sources may be placed on two or more different sides of the joystick controller e.g. on the front and on the back as shown in phantom . Such placement allows the image capture unit to obtain images of the light sources for different orientations of the joystick controller depending on how the joystick controller is held by a user.

In addition the light sources may provide telemetry signals to the processor e.g. in pulse code amplitude modulation or frequency modulation format. Such telemetry signals may indicate which joystick buttons are being pressed and or how hard such buttons are being pressed. Telemetry signals may be encoded into the optical signal e.g. by pulse coding pulse width modulation frequency modulation or light intensity amplitude modulation. The processor may decode the telemetry signal from the optical signal and execute a game command in response to the decoded telemetry signal. Telemetry signals may be decoded from analysis of images of the joystick controller obtained by the image capture unit . Alternatively the apparatus may include a separate optical sensor dedicated to receiving telemetry signals from the lights sources . The use of LEDs in conjunction with determining an intensity amount in interfacing with a computer program is described e.g. in commonly owned U.S. patent application Ser. No. 11 429 414 to Richard L. Marks et al. entitled USE OF COMPUTER IMAGE AND AUDIO PROCESSING IN DETERMINING AN INTENSITY AMOUNT WHEN INTERFACING WITH A COMPUTER PROGRAM which is incorporated herein by reference in its entirety. In addition analysis of images containing the light sources may be used for both telemetry and determining the position and or orientation of the joystick controller . Such techniques may be implemented by program code instructions which may be stored in the memory and executed by the processor .

The processor may use the inertial signals from the inertial sensor in conjunction with optical signals from light sources detected by the image capture unit and or sound source location and characterization information from acoustic signals detected by the microphone array to deduce information on the location and or orientation of the joystick controller and or its user. For example acoustic radar sound source location and characterization may be used in conjunction with the microphone array to track a moving voice while motion of the joystick controller is independently tracked through the inertial sensor and or light sources . Any number of different combinations of different modes of providing control signals to the processor may be used in conjunction with embodiments of the present invention. Such techniques may be implemented by program code instructions which may be stored in the memory and executed by the processor .

Signals from the inertial sensor may provide part of a tracking information input and signals generated from the image capture unit from tracking the one or more light sources may provide another part of the tracking information input. By way of example and without limitation such mixed mode signals may be used in a football type video game in which a Quarterback pitches the ball to the right after a head fake head movement to the left. Specifically a game player holding the controller may turn his head to the left and make a sound while making a pitch movement swinging the controller out to the right like it was the football. The microphone array in conjunction with acoustic radar program code can track the user s voice. The image capture unit can track the motion of the user s head or track other commands that do not require sound or use of the controller. The sensor may track the motion of the joystick controller representing the football . The image capture unit may also track the light sources on the controller . The user may release of the ball upon reaching a certain amount and or direction of acceleration of the joystick controller or upon a key command triggered by pressing a button on the joystick controller .

In certain embodiments of the present invention an inertial signal e.g. from an accelerometer or gyroscope may be used to determine a location of the joystick controller . Specifically an acceleration signal from an accelerometer may be integrated once with respect to time to determine a change in velocity and the velocity may be integrated with respect to time to determine a change in position. If values of the initial position and velocity at some time are known then the absolute position may be determined using these values and the changes in velocity and position. Although position determination using an inertial sensor may be made more quickly than using the image capture unit and light sources the inertial sensor may be subject to a type of error known as drift in which errors that accumulate over time can lead to a discrepancy D between the position of the joystick calculated from the inertial signal shown in phantom and the actual position of the joystick controller . Embodiments of the present invention allow a number of ways to deal with such errors.

For example the drift may be cancelled out manually by re setting the initial position of the joystick controller to be equal to the current calculated position. A user may use one or more of the buttons on the joystick controller to trigger a command to re set the initial position. Alternatively image based drift may be implemented by re setting the current position to a position determined from an image obtained from the image capture unit as a reference. Such image based drift compensation may be implemented manually e.g. when the user triggers one or more of the buttons on the joystick controller . Alternatively image based drift compensation may be implemented automatically e.g. at regular intervals of time or in response to game play. Such techniques may be implemented by program code instructions which may be stored in the memory and executed by the processor .

In certain embodiments it may be desirable to compensate for spurious data in the inertial sensor signal. For example the signal from the inertial sensor may be oversampled and a sliding average may be computed from the oversampled signal to remove spurious data from the inertial sensor signal. In some situations it may be desirable to oversample the signal and reject a high and or low value from some subset of data points and compute the sliding average from the remaining data points. Furthermore other data sampling and manipulation techniques may be used to adjust the signal from the inertial sensor to remove or reduce the significance of spurious data. The choice of technique may depend on the nature of the signal computations to be performed with the signal the nature of game play or some combination of two or more of these. Such techniques may be implemented by program code instructions which may be stored in the memory and executed by the processor .

The processor may perform digital signal processing on signal data in response to the data and program code instructions of a program stored and retrieved by the memory and executed by the processor module . Code portions of the program may conform to any one of a number of different programming languages such as Assembly C JAVA or a number of other languages. The processor module forms a general purpose computer that becomes a specific purpose computer when executing programs such as the program code . Although the program code is described herein as being implemented in software and executed upon a general purpose computer those skilled in the art will realize that the method of task management could alternatively be implemented using hardware such as an application specific integrated circuit ASIC or other hardware circuitry. As such it should be understood that embodiments of the invention can be implemented in whole or in part in software hardware or some combination of both.

In one embodiment among others the program code may include a set of processor readable instructions that implement any one or more of the methods and techniques described herein or some combination of two or more of such methods and techniques. For example the program code may be configured to implement the image analyzer function described herein. Or alternatively the image analyzer function described herein may be implemented in hardware.

In the illustrated embodiment the image analyzer function described above is illustrated as the image analyzer . The image analyzer may receive its input from a camera such as for example the image capture unit or the camera . Thus the output of the video camera or the image capture unit may be coupled to the input of the image analyzer . The output of the image analyzer may be provided to the system of the apparatus . This way either commands themselves or information needed to see if a command or gesture has been recognized is provided to the apparatus . The image analyzer may be coupled to the rest of the apparatus in many different ways as such the illustrated connections are just one example. As another example the image analyzer may be coupled to the system bus which will allow it to receive its input data from the image capture unit and provide its output to the apparatus .

The image analyzer may optionally be included in the apparatus or the entertainment system or console or the image analyzer may be located separately from these devices and systems. And again it should be well understood that the image analyzer may be implemented in whole or in part in software hardware or some combination of both. In the scenario where the image analyzer is implemented in software then the block represents the image analyzer function implemented in software.

The program code may generally include one or more instructions that direct the one or more processors to select a pre calibrated listening zone at runtime and filter out sounds originating from sources outside the pre calibrated listening zone. The pre calibrated listening zones may include a listening zone that corresponds to a volume of focus or field of view of the image capture unit .

The program code may include one or more instructions which when executed cause the apparatus to select a pre calibrated listening sector that contains a source of sound. Such instructions may cause the apparatus to determine whether a source of sound lies within an initial sector or on a particular side of the initial sector. If the source of sound does not lie within the default sector the instructions may when executed select a different sector on the particular side of the default sector. The different sector may be characterized by an attenuation of the input signals that is closest to an optimum value. These instructions may when executed calculate an attenuation of input signals from the microphone array and the attenuation to an optimum value. The instructions may when executed cause the apparatus to determine a value of an attenuation of the input signals for one or more sectors and select a sector for which the attenuation is closest to an optimum value.

The program code may optionally include one or more instructions that direct the one or more processors to produce a discrete time domain input signal x t from the microphones M. . . M determine a listening sector and use the listening sector in a semi blind source separation to select the finite impulse response filter coefficients to separate out different sound sources from input signal x t . The program may also include instructions to apply one or more fractional delays to selected input signals x t other than an input signal x t from a reference microphone M. Each fractional delay may be selected to optimize a signal to noise ratio of a discrete time domain output signal y t from the microphone array. The fractional delays may be selected to such that a signal from the reference microphone Mis first in time relative to signals from the other microphone s of the array. The program may also include instructions to introduce a fractional time delay into an output signal y t of the microphone array so that y t x t b x t 1 b x t 2 b . . . x t N b where is between zero and 1.

The program code may optionally include processor executable instructions including one or more instructions which when executed cause the image capture unit to monitor a field of view in front of the image capture unit identify one or more of the light sources within the field of view detect a change in light emitted from the light source s and in response to detecting the change triggering an input command to the processor . The use of LEDs in conjunction with an image capture device to trigger actions in a game controller is described e.g. in commonly owned U.S. patent application Ser. No. 10 759 782 to Richard L. Marks filed Jan. 16 2004 and entitled METHOD AND APPARATUS FOR LIGHT INPUT DEVICE which is incorporated herein by reference in its entirety.

The program code may optionally include processor executable instructions including one or more instructions which when executed use signals from the inertial sensor and signals generated from the image capture unit from tracking the one or more light sources as inputs to a game system e.g. as described above. The program code may optionally include processor executable instructions including one or more instructions which when executed compensate for drift in the inertial sensor .

In addition the program code may optionally include processor executable instructions including one or more instructions which when executed adjust the gearing and mapping of controller manipulations to game a environment. Such a feature allows a user to change the gearing of manipulations of the joystick controller to game state. For example a 45 degree rotation of the joystick controller may be geared to a 45 degree rotation of a game object. However this 1 1 gearing ratio may be modified so that an X degree rotation or tilt or yaw or manipulation of the controller translates to a Y rotation or tilt or yaw or manipulation of the game object. Gearing may be 1 1 ratio 1 2 ratio 1 X ratio or X Y ratio where X and Y can take on arbitrary values. Additionally mapping of input channel to game control may also be modified over time or instantly. Modifications may comprise changing gesture trajectory models modifying the location scale threshold of gestures etc. Such mapping may be programmed random tiered staggered etc. to provide a user with a dynamic range of manipulatives. Modification of the mapping gearing or ratios can be adjusted by the program code according to game play game state through a user modifier button key pad etc. located on the joystick controller or broadly in response to the input channel. The input channel may include but may not be limited to elements of user audio audio generated by controller tracking audio generated by the controller controller button state video camera output controller telemetry data including accelerometer data tilt yaw roll position acceleration and any other data from sensors capable of tracking a user or the user manipulation of an object.

In certain embodiments the program code may change the mapping or gearing over time from one scheme or ratio to another scheme respectively in a predetermined time dependent manner. Gearing and mapping changes can be applied to a game environment in various ways. In one example a video game character may be controlled under one gearing scheme when the character is healthy and as the character s health deteriorates the system may gear the controller commands so the user is forced to exacerbate the movements of the controller to gesture commands to the character. A video game character who becomes disoriented may force a change of mapping of the input channel as users for example may be required to adjust input to regain control of the character under a new mapping. Mapping schemes that modify the translation of the input channel to game commands may also change during gameplay. This translation may occur in various ways in response to game state or in response to modifier commands issued under one or more elements of the input channel. Gearing and mapping may also be configured to influence the configuration and or processing of one or more elements of the input channel.

In addition a speaker may be mounted to the joystick controller . In acoustic radar embodiments wherein the program code locates and characterizes sounds detected with the microphone array the speaker may provide an audio signal that can be detected by the microphone array and used by the program code to track the position of the joystick controller . The speaker may also be used to provide an additional input channel from the joystick controller to the processor . Audio signals from the speaker may be periodically pulsed to provide a beacon for the acoustic radar to track location. The audio signals pulsed or otherwise may be audible or ultrasonic. The acoustic radar may track the user manipulation of the joystick controller and where such manipulation tracking may include information about the position and orientation e.g. pitch roll or yaw angle of the joystick controller . The pulses may be triggered at an appropriate duty cycle as one skilled in the art is capable of applying. Pulses may be initiated based on a control signal arbitrated from the system. The apparatus through the program code may coordinate the dispatch of control signals amongst two or more joystick controllers coupled to the processor to assure that multiple controllers can be tracked.

By way of example embodiments of the present invention may be implemented on parallel processing systems. Such parallel processing systems typically include two or more processor elements that are configured to execute parts of a program in parallel using separate processors. By way of example and without limitation illustrates a type of cell processor according to an embodiment of the present invention. The cell processor may be used as the processor of . In the example depicted in the cell processor includes a main memory power processor element PPE and a number of synergistic processor elements SPEs . In the example depicted in the cell processor includes a single PPE and eight SPE . In such a configuration seven of the SPE may be used for parallel processing and one may be reserved as a back up in case one of the other seven fails. A cell processor may alternatively include multiple groups of PPEs PPE groups and multiple groups of SPEs SPE groups . In such a case hardware resources can be shared between units within a group. However the SPEs and PPEs must appear to software as independent elements. As such embodiments of the present invention are not limited to use with the configuration shown in .

The main memory typically includes both general purpose and nonvolatile storage as well as special purpose hardware registers or arrays used for functions such as system configuration data transfer synchronization memory mapped I O and I O subsystems. In embodiments of the present invention a signal processing program may be resident in main memory . The signal processing program may run on the PPE. The program may be divided up into multiple signal processing tasks that can be executed on the SPEs and or PPE.

By way of example the PPE may be a 64 bit PowerPC Processor Unit PPU with associated caches L1 and L2. The PPE is a general purpose processing unit which can access system management resources such as the memory protection tables for example . Hardware resources may be mapped explicitly to a real address space as seen by the PPE. Therefore the PPE can address any of these resources directly by using an appropriate effective address value. A primary function of the PPE is the management and allocation of tasks for the SPEs in the cell processor .

Although only a single PPE is shown in some cell processor implementations such as cell broadband engine architecture CBEA the cell processor may have multiple PPEs organized into PPE groups of which there may be more than one. These PPE groups may share access to the main memory . Furthermore the cell processor may include two or more groups SPEs. The SPE groups may also share access to the main memory . Such configurations are within the scope of the present invention.

Each SPE is includes a synergistic processor unit SPU and its own local storage area LS. The local storage LS may include one or more separate areas of memory storage each one associated with a specific SPU. Each SPU may be configured to only execute instructions including data load and data store operations from within its own associated local storage domain. In such a configuration data transfers between the local storage LS and elsewhere in a system may be performed by issuing direct memory access DMA commands from the memory flow controller MFC to transfer data to or from the local storage domain of the individual SPE . The SPUs are less complex computational units than the PPE in that they do not perform any system management functions. The SPU generally have a single instruction multiple data SIMD capability and typically process data and initiate any required data transfers subject to access properties set up by the PPE in order to perform their allocated tasks. The purpose of the SPU is to enable applications that require a higher computational unit density and can effectively use the provided instruction set. A significant number of SPEs in a system managed by the PPE allow for cost effective processing over a wide range of applications.

Each SPE may include a dedicated memory flow controller MFC that includes an associated memory management unit that can hold and process memory protection and access permission information. The MFC provides the primary method for data transfer protection and synchronization between main storage of the cell processor and the local storage of an SPE. An MFC command describes the transfer to be performed. Commands for transferring data are sometimes referred to as MFC direct memory access DMA commands or MFC DMA commands .

Each MFC may support multiple DMA transfers at the same time and can maintain and process multiple MFC commands. Each MFC DMA data transfer command request may involve both a local storage address LSA and an effective address EA . The local storage address may directly address only the local storage area of its associated SPE. The effective address may have a more general application e.g. it may be able to reference main storage including all the SPE local storage areas if they are aliased into the real address space.

To facilitate communication between the SPEs and or between the SPEs and the PPE the SPEs and PPE may include signal notification registers that are tied to signaling events. The PPE and SPEs may be coupled by a star topology in which the PPE acts as a router to transmit messages to the SPEs . Alternatively each SPE and the PPE may have a one way signal notification register referred to as a mailbox. The mailbox can be used by an SPE to host operating system OS synchronization.

The cell processor may include an input output I O function through which the cell processor may interface with peripheral devices such as a microphone array and optional image capture unit . In addition an Element Interconnect Bus may connect the various components listed above. Each SPE and the PPE can access the bus through a bus interface units BIU. The cell processor may also includes two controllers typically found in a processor a Memory Interface Controller MIC that controls the flow of data between the bus and the main memory and a Bus Interface Controller BIC which controls the flow of data between the I O and the bus . Although the requirements for the MIC BIC BIUs and bus may vary widely for different implementations those of skill in the art will be familiar their functions and circuits for implementing them.

The cell processor may also include an internal interrupt controller IIC. The IIC component manages the priority of the interrupts presented to the PPE. The IIC allows interrupts from the other components the cell processor to be handled without using a main system interrupt controller. The IIC may be regarded as a second level controller. The main system interrupt controller may handle interrupts originating external to the cell processor.

In embodiments of the present invention certain computations such as fractional delays may be performed in parallel using the PPE and or one or more of the SPE . Each fractional delay calculation may be run as one or more separate tasks that different SPE may take as they become available.

While the invention herein disclosed has been described by means of specific embodiments and applications thereof numerous modifications and variations could be made thereto by those skilled in the art without departing from the scope of the invention set forth in the claims.

