---

title: Application-originated text messages delivered over a packet-switched network
abstract: Systems and methods are disclosed for correlating messages used to deliver an Application Originated (AO) text message to User Equipment (UE). A text message gateway is implemented between a text message application and a packet-switched network that uses Session Initiation Protocol (SIP). The text message gateway receives a delivery request from the text message application that includes an Application Originated (AO) text message intended for the UE. The text message gateway identifies a correlation identifier (ID) for the AO text message, inserts the correlation ID in a delivery response, and transmits the delivery response to the text message application (to store for later use). The text message gateway also converts the delivery request into a SIP request that encapsulates the AO text message, inserts the correlation ID in the SIP request, and transmits the SIP request to the UE.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08848604&OS=08848604&RS=08848604
owner: Alcatel Lucent
number: 08848604
owner_city: Boulogne Billancourt
owner_country: FR
publication_date: 20110110
---
The invention is related to the field of communications and in particular to correlating signaling messages that are used to deliver application originated AO text messages.

Text messaging has become a popular mode of communication in many mobile or wireless networks. One example of text messaging is Short Message Service SMS which is a set of communication protocols allowing the exchange of short text messages i.e. 160 characters or less between devices. While the term text message traditionally referred to text only messages sent using SMS it has been extended to include multimedia messages such as images video sound content etc. The multimedia messages may be sent using Multimedia Message Service MMS protocol. Often times mobile users more frequently use text messaging for communication than voice calls.

Although text messaging is traditionally thought of as two end users exchanging text messages through mobile devices there may be automated applications i.e. not a real person that exchange text messages with an end user. As an example an External Short Messaging Entity ESME is a device server that includes an application which is able to send and or receive text messages e.g. SMS . An ESME connects to the network through a fixed connection using protocols such as Short Message Peer to Peer SMPP protocol Universal Computer Protocol UCP RESTful HTTP Parlay etc. Typical examples of ESMEs are servers that send automated marketing messages to mobile devices voting systems that process votes via text message etc.

To send a text message an application encapsulates the text message in a signaling message of its protocol. The protocol may be proprietary or may be one commonly used in the industry such as SMPP. A text message that is originated by an application in this manner is referred to herein as an Application Originated AO text message. When the AO text message is being sent to a Session Initiation Protocol SIP based network such as an IP Multimedia Subsystem IMS or Long Term Evolution LTE network the AO text message is passed through a gateway. This is assuming that the application does not have a SIP interface. The gateway converts the text message from the signaling protocol used by the application to a SIP request e.g. SIP MESSAGE and forwards the SIP request towards the destination referred to as a recipient over the SIP based network.

The technical specifications of the 3Generation Partnership Project 3GPP and 3GPP2 have defined how text messages are exchanged over packet switched networks using SIP such as 3GPP Technical Specification TS 24.341. As part of these specifications when a text message is delivered to a recipient the recipient s device initiates a new SIP transaction to report back on the delivery success failure of the text message. Thus the recipient s device sends a new SIP request back to the gateway indicating the delivery success failure of the text message.

Unfortunately it is a problem to effectively correlate the multiple SIP transactions for an AO MT text message.

Embodiments described herein allow for correlation of multiple SIP transactions using a correlation ID. When a gateway receives a text message initiated by an application the gateway identifies a correlation ID and sends the correlation ID to the application. The gateway also embeds the correlation ID in the SIP request used to transport the text message to the recipient. The recipient s device User Equipment receives the SIP request and initiates a new SIP request new SIP transaction to report the delivery success failure for the text message. The recipient s device embeds the correlation ID in the new SIP request along with an indication of the delivery success failure for the text message. When the gateway receives the new SIP request the gateway locates the correlation ID and associates the new SIP request with the prior SIP request and the original delivery request based on the correlation ID. By correlating the new SIP request with the original delivery request from the application the gateway is able to send a delivery response to the application that includes the correlation ID and a delivery report for the text message. The application will be able to correlate the initial delivery request for the text message with the delivery response having the delivery report of the text message based on the correlation ID. Thus the correlation ID advantageously allows the gateway to correlate multiple SIP transactions. The correlation ID also allows the application to correlate a delivery request with a delivery response so that the application is aware of the delivery status of a text message.

One embodiment comprises a text message gateway that interworks communications between a text message application and a packet switched network that uses SIP. When in operation the text message gateway receives a first delivery request from the text message application that includes an Application Originated AO text message intended for User Equipment UE being served by the packet switched network. The text message gateway identifies a correlation identifier ID for the AO text message inserts the correlation ID in a delivery response and transmits the delivery response to the text message application. The text message application may then store the correlation ID for later use. The text message gateway also converts the first delivery request into a first SIP request e.g. SIP MESSAGE that encapsulates the AO text message inserts the correlation ID in the first SIP request and transmits the first SIP request to the UE.

In another embodiment the text message gateway receives a second SIP request e.g. another SIP MESSAGE from the UE that includes a delivery report for the AO text message parses the second SIP request to identify the correlation ID and correlates the second SIP request with the first SIP request and the first delivery request based on the correlation ID. The text message system may then insert the delivery report for the AO text message into a second delivery request insert the correlation ID in the second delivery request and transmit the second delivery request to the text message application. The text message application is able to correlate the delivery report with the first delivery request originally used to send the AO text message to the UE. Thus the gateway is able to provide a delivery status of the AO text message to the text message application in an effective manner so that the application is able to determine whether or not the text message was successfully received by its recipient.

The figures and the following description illustrate specific exemplary embodiments of the invention. It will thus be appreciated that those skilled in the art will be able to devise various arrangements that although not explicitly described or shown herein embody the principles of the invention and are included within the scope of the invention. Furthermore any examples described herein are intended to aid in understanding the principles of the invention and are to be construed as being without limitation to such specifically recited examples and conditions. As a result the invention is not limited to the specific embodiments or examples described below but by the claims and their equivalents.

External message center comprises any system server or device that is able to generate a text message and send the text message to packet switched network for delivery to UE . One example of external message center is an ESME. Typical examples of ESMEs are systems that send automated marketing messages to mobile users voting systems that process text message votes etc. In this embodiment external message center includes a text message application that generates text messages and initiates transmission of the text messages to packet switched network .

Packet switched network comprises any network that exchanges communications using packets such as IP packets. Packet switched network may comprise an IMS network an LTE network or any other IP based network. Packet switched network may include a variety of elements in order to provide voice and or data services to UE such as network element . Some examples of network element include a Serving Call Session Control Function S CSCF a PDN Gateway P GW etc.

Communication system also includes a text message gateway . Text message gateway comprises any system server or device that interworks communications between external message center and UE and or network element in packet switched network . Application in external message center may not support protocols that are used for message delivery in packet switched network such as SIP. Thus text message gateway allows application and various other applications to send text messages in different protocols e.g. APIs toward packet switched network such as Parlay RESTful LDAP XML and SMPP. For example if application sends a text message intended for UE application may use a RESTful API to send the text message. Text message gateway is able to normalize the RESTful protocol message and convert it into a SIP request. Text message gateway may then send the SIP request to UE over packet switched network to deliver the original text message. Some examples of text message gateway include an IP SM GW in an IMS network or an LTE SMS gateway in an LTE network.

Text message gateway may be part of a packet switched network as shown in or may be coupled to packet switched network in order to interwork messages sent to packet switched network . Also communication system may have multiple text message gateways to handle the higher traffic loads for geo redundancy etc. Thus text message gateway as illustrated in may represent a single gateway or a cluster of gateways e.g. gateway A gateway B gateway C etc .

Text message gateway includes a network interface and a control system . Network interface comprises any device or component that communicates with external message center and other message centers through a variety of protocols. Network interface is also able to communicate with one or more elements of packet switched network through a protocol used within packet switched network such as SIP. Control system comprises any device or component that correlates messages between external message center and UE .

In the following embodiments when application originates a text message intended for UE application sends the text message to gateway for interworking. This text message is referred to as Application Originated AO text message. Gateway then sends the text message to UE in a SIP request. As a background there are a set of commands defined within SIP that are referred to as SIP requests or methods . One such SIP request is a SIP MESSAGE that is used to transport instant messages IM text messages etc. SIP also defines a set of commands referred to as SIP responses. The SIP responses are used to respond to a particular SIP request. Some common SIP responses are 1xx 2xx 3xx 4xx 5xx and 6xx.

Presently when a SIP request that encapsulates a text message is sent to a device the receiving device does not provide a delivery report text messaging acknowledgement or error of the text message in a SIP response. The receiving device provides a SIP response acknowledgement that the SIP request itself was received such as in a SIP 200 OK. But this SIP response does not indicate whether the text message within the SIP request was successfully delivered to its recipient s it only indicates the delivery status of the SIP request. There may be a variety of reasons why the SIP request was successfully received but there were errors with the text message inside of the SIP request which are beyond the scope of this discussion. Per 3GPP specifications the receiving device initiates a new SIP transaction to provide a delivery report of the text message by sending a separate SIP request that reports the delivery status.

The embodiments described herein allow for correlation of the multiple SIP transactions in gateway when handling an AO text message. The correlation is possible using a correlation ID which is further described in .

In step network interface receives the AO text message from application of external message center . The text message is presumably encapsulated in a delivery request of a protocol other than SIP such as a Parlay RESTful LDAP XML or SMPP. One example of a delivery request in SMPP is a submit sm request. Application may request require a delivery receipt or delivery acknowledgement for the text message which will be further described below.

In step control system identifies a correlation identifier ID for the text message. The correlation ID comprises any string integer or value defined for the text message for correlating messages involved in the delivery of the text message. Control system may generate a new unique ID in response to receiving the text message. Control system may alternatively re use a message ID that was received along with the text message from application in the delivery request.

In step control system generates a delivery response in the appropriate protocol and inserts the correlation ID in the delivery response. For example if the delivery request is an SMPP submit sm request then control system may generate submit resp response as the delivery response. In step network interface transmits the delivery response to application in external message center . Application may then parse the delivery response to identify the correlation ID and store the correlation ID for later use.

In step control system converts or interworks the delivery request to SIP so that the text message is encapsulated or embedded in a SIP request. The SIP request may comprise a SIP MESSAGE or another type of SIP request that transports text messages e.g. SMS messages . Control system may embed the text message in the MAP RP DATA field of the SIP request. In step control system also inserts or embeds the correlation ID in the SIP request. For example control system may insert the correlation ID in a MAP RP Message Reference field of the SIP request. Control system may also identify a gateway ID for gateway and insert or embed the gateway ID in the SIP request along with the correlation ID. The gateway ID comprises any string integer or value that uniquely references a text message gateway such as gateway . Packet switched network may have multiple gateways that are used to convert or interwork text messages from application to UE for redundancy and load balancing. The gateway ID will be utilized to correlate the SIP requests when they arrive at different gateways.

In step network interface transmits the SIP request to network element for delivery to UE . Upon receiving the SIP request network element attempts to deliver the SIP request to UE .

In step UE receives the SIP request from network element where the SIP request encapsulates the text message. UE transmits a SIP 200 OK to gateway through network element acknowledging the successful receipt of the SIP request. In step UE determines a processing status for the encapsulated text message to generate a delivery report of the text message either in acknowledgement or error report format . The delivery report of the text message is separate from the status of delivering the SIP request which carried the text message this is done with a 200 OK or SIP 3xx 4xx 5xx response . A delivery report comprises any information indicating the success or failure of processing a text message such as RP DATA . The process used to determine the delivery report of a text message is beyond the scope of this application. However in one example UE may parse the data for the text message to determine if there were addressing errors formatting errors or any other types of errors. If one or more errors are detected in parsing the text message then UE may determine that delivery of the text message has failed. If no errors are detected in parsing the text message then UE may determine that delivery of the text message was successful.

In step UE parses the original SIP request to identify the correlation ID. UE may parse the MAP RP Message Reference field to find the correlation ID. UE then generates a new SIP request for reporting the delivery status of the text message and inserts the correlation ID in the new SIP request see steps and . The new SIP request may again comprise a SIP MESSAGE or another type of SIP request that transports text messages e.g. SMS messages . To insert the correlation ID in the new SIP request UE may copy the MAP RP Message Reference field of the original SIP request into the MAP RP Message Reference field of the new SIP request. In step UE inserts the delivery report of the text message in the new SIP request. For example UE may set the MAP RP Message Type to RP ACK or RP ERROR in the new SIP request. In step UE transmits the new SIP request to gateway through network element .

Control system is also able to correlate the two SIP request with the original delivery request from application . By correlating the SIP requests with the original delivery request from application based on the correlation ID control system is able to provide application with the delivery report for the text message. To do so control system inserts the delivery report for the text message into a new delivery request in step . One example of the new delivery request in SMPP is a deliver sm request. Control system also inserts the correlation ID in the new delivery request in step . Network interface then transmits the new delivery request to application in step .

Thus application will be able to correlate the original delivery request for the text message with the new delivery request based on the correlation ID. Application will thus be able to correlate the delivery report from the new delivery request to the AO text message from the original delivery request and determine whether or not the text message was successfully delivered to its recipient s . The correlation ID advantageously allows gateway to correlate multiple SIP transactions in reporting the delivery status of the text message. The correlation ID also allows gateway to provide the delivery report back to application because all of the requests used to transport the text message and the delivery report between application and UE are embedded with the common correlation ID. As a result delivery reports receipts may be effectively provided for AO MT text messages.

CDMA network includes a Home Location Register HLR a Mobile Switching Center MSC and Packet Data Network Gateway PDN GW . HLR is a central subscriber database that stores subscription information and other details e.g. subscriber profiles of UEs that are authorized to use CDMA network . MSC is the serving node for UEs and is responsible for handling voice calls SMS and other services in CDMA network . PDN GW comprises any node or element in CDMA network that interworks signaling between CDMA network and a packet switched network such as IMS network . CDMA network may include other network elements that are not shown for the sake of brevity such as base stations a radio network controller etc.

IMS network includes Proxy Call Session Control Function P CSCF a Serving Call Session Control Function S CSCF a Home Subscriber Server HSS and a packet gateway P GW . P CSCF is the entry point to the IMS domain and serves as the outbound proxy server for IMS devices. S CSCF is the central node of the signaling plane and performs session control for IMS devices that initiate sessions over IMS network . S CSCF communicates with IMS devices over one or more access networks that are not shown in . HSS is a subscriber server that stores subscription related information e.g. subscriber profiles performs authentication and authorization of end users provides information about the subscriber s location etc. P GW comprises any node or element in IMS network that exchanges packets with external networks.

Communication system also includes an SMS Center SMSC and one or more Short Message Gateways SM GW which may comprise an LTE gateway an IP Short Message Gateway IP SM GW or some other gateway that handles SMS over IP. SMSC comprises any node for a circuit switched network that delivers SMS messages using store and forward processing. SM GWs comprises any node that interworks signaling between a SIP based network and a network or device that uses a different signaling protocol. For example if a network or device uses Short Message Peer to Peer SMPP protocol to exchange SMS messages then SM GWs interwork the SMPP protocol messages to SIP and vice versa. Communication system also includes External Short Messaging Entities ESME and . An ESME is an external application that connects to SMSC or SM GW to engage in the sending and or receiving of SMS messages.

Assume for this embodiment that ESME generates an SMS message that is intended for UE . The following embodiment illustrates how a delivery status is provided in a SIP response.

In response to the submit sm request SM GW identifies a correlation ID for the SMS message. SM GW may generate a new unique ID in response to receiving the submit sm request. Alternatively SM GW may re use a message ID that was received in the submit sm request from ESME . SM GW then generates a submit resp response and inserts the correlation ID in the submit resp response. SM GW then sends the submit resp response to ESME with the correlation ID CORR ID . ESME parses the submit resp response and stores the correlation ID for later use.

Next SM GW queries HSS for the registration status of UE using a Diameter User Data Request UDR . HSS determines that UE is registered and responds to SM GW with a Diameter User Data Answer UDA indicating that UE is registered. SM GW then constructs a SIP MESSAGE that encapsulates the SMS message. The SMS message is embedded in the RP DATA e.g. RP USER DATA field of the SIP MESSAGE. SM GW also embeds the correlation ID and a gateway ID for SM GW in the SIP MESSAGE. For example SM GW may embed the correlation ID and the gateway ID as a combination string in the RP DATA e.g. RP Message Reference field encapsulated in the SIP MESSAGE. The SIP MESSAGE header may be constructed as follows 

SM GW then sends the SIP MESSAGE to S CSCF in IMS network . S CSCF in turn routes the SIP MESSAGE to UE where UE receives the SIP MESSAGE successfully. Therefore UE transmits a SIP 200 OK to S CSCF acknowledging the successful receipt of the SIP MESSAGE. S CSCF forwards the SIP 200 OK to SM GW .

UE also attempts to parse the SMS message RP DATA in the SIP MESSAGE to determine whether or not the SMS message was successfully delivered. Assume for this embodiment that the SMS was successfully delivered. UE consequently determines that delivery of the SMS message was successful and informs SM GW of the successful delivery as follows. UE generates a new SIP MESSAGE for a new SIP transaction and embeds the correlation ID and the gateway ID in the RP ACK RP Message Reference field of the SIP MESSAGE. Essentially UE copies the RP Message Reference field from the received SIP MESSAGE into the new SIP MESSAGE. UE also inserts a delivery report in the new SIP MESSAGE. UE then transmits the new SIP MESSAGE to S CSCF . The new SIP MESSAGE may look as follows 

S CSCF resolves VIP address from the new SIP MESSAGE and routes SIP MESSAGE to SM GW where SM GW receives the new SIP MESSAGE successfully. Therefore SM GW transmits a SIP 200 OK to S CSCF acknowledging the successful receipt of the new SIP MESSAGE. S CSCF forwards the SIP 200 OK to UE .

After receiving the new SIP MESSAGE SM GW parses the RP ACK from the SIP MESSAGE and the RP Message Reference field to identify the correlation ID. SM GW discovers previous RP DATA message was sent by SM GW based on the gateway ID for SM GW . Thus SM GW correlates the new SIP request to the original SIP request and the original SMPP request from ESME . Because all payload data is complete for the SMS message SM GW transmits a SMPP deliver sm request to ESME with the correlation ID and delivery report. SM GW sets the receipted message id in the SMPP deliver sm request to the correlation ID. SM GW also notifies SM GW of the transactions. SM GW saves transaction data in a database.

ESME receives the deliver sm request from SM GW . This request is a separate SMPP transaction much like the two SIP MESSAGES were different SIP transactions. However ESME is able to correlate the deliver sm request to the submit sm request based on the correlation ID. SM GW may thus identify the delivery report for the SMS message based on the status information inserted in the deliver sm request. Thus ESME is advantageously able to correlate the delivery status information with the SMS message that was sent. Even though SM GW translated the SMS message from SMPP to SIP ESME was able to receive delivery status information for the SMS message.

Any of the various elements shown in the figures or described herein may be implemented as hardware software firmware or some combination of these. For example an element may be implemented as dedicated hardware. Dedicated hardware elements may be referred to as processors controllers or some similar terminology. When provided by a processor the functions may be provided by a single dedicated processor by a single shared processor or by a plurality of individual processors some of which may be shared. Moreover explicit use of the term processor or controller should not be construed to refer exclusively to hardware capable of executing software and may implicitly include without limitation digital signal processor DSP hardware a network processor application specific integrated circuit ASIC or other circuitry field programmable gate array FPGA read only memory ROM for storing software random access memory RAM non volatile storage logic or some other physical hardware component or module.

Also an element may be implemented as instructions executable by a processor or a computer to perform the functions of the element. Some examples of instructions are software program code and firmware. The instructions are operational when executed by the processor to direct the processor to perform the functions of the element. The instructions may be stored on storage devices that are readable by the processor. Some examples of the storage devices are digital or solid state memories magnetic storage media such as a magnetic disks and magnetic tapes hard drives or optically readable digital data storage media.

Although specific embodiments were described herein the scope of the invention is not limited to those specific embodiments. The scope of the invention is defined by the following claims and any equivalents thereof.

